C*********************************
	SUBROUTINE IPHII
        COMMON /DATA/Q(300,200),IPL(200),QMAX,QMIN,IS,IE,IPP,NPL,NT,
     1PRE(300),AT,QO(300),IOBS,IPR,ILIST,PA(300),EXE(300),NTT,PER(300),
     2PMAX,VOP(300),P(300,10)
	READ(1,140) AIO,AIB,HK,RMAX,RT1,AINP
140	FORMAT(6F10.2)
	RT11=RT1*AT/0.1E+04
	TOTP=0.0
	TOTL=0.0
	TOTE=0.0
	BI=AIO/ALOG(HK)/(AIO-AIB)
	AI=-AIO*BI
	ATT=0.
	BT=-AIO/AIB/ALOG(HK)
	AIL=-AI/BI
	BIL=1./BI
	ATL=0.
	BTL=1/BT
	SMAX=-AIO/ALOG(HK)
	SX=RT11*(0.5+BT)
	SO=SX
	RI=AIL+BIL*SX
	T=ATL+BTL*SX
	R=0.
	DO 1 I=1,NTT
	RD=RMAX-R
        PR=PRE(I)
	IF(PR.GT.RD) GO TO 2
	R=R+PR
	PR=0.
	GO TO 6
2	PR=PR-RD
	R=RMAX
6	AT1=1.
	VES=PR*AINP
	PR=PR-VES
	IF(PR.GE.RI) GO TO 4
	S1=(SX*(2.-1/BT)+2*PR)/(2+1/BT)
	RI1=AIL+BIL*S1
	IF(PR.GE.RI1) GO TO 5
	T=ATL+BTL*S1
	VE=0.
	VI=PR
	GO TO 8
5	SXX=AI+BI*PR
	ATX=2.*BT*(SXX-SX)/(2.*PR*BT+2.*ATT-SXX-SX)
	AT1=AT1-ATX
	RAUX=PR
	VAUX=PR*ATX
	GO TO 7
4	RAUX=RI
	VAUX=0.0
7	RI1=AIB+(RAUX-AIB)*HK**AT1
	S1=AI+BI*RI1
	T=ATL+BTL*S1
	VI=AIB*AT1+(RAUX-AIB)*(HK**AT1-1)/ALOG(HK)+VAUX
 	VE=PR*AT1-VI+VAUX
8	VOP(I)=SX-S1+VI
	VE=VE+VES
	PER(I)=PRE(I)-VE
	EXE(I)=VE
	TOTL=TOTL+PRE(I)
	TOTP=TOTP+PER(I)
	TOTE=TOTE+EXE(I)
	SX=S1
	RI=RI1
1	CONTINUE
	WRITE(2,150) AIO,AIB,HK,SO,RMAX
150	FORMAT(2(/),10X,'METODO IPHII',2(/),/,10X,
     1'AIO =',F10.1,' MM/H' /,10X,'AIB =',F10.1,' MM/H'/,10X,
     1'HK  =',F10.2,/,
     110X,'ST  =',F10.2,' MM'/,10X,'RMAX=',F10.1,' MM',3(/))
	IF(IPP.EQ.0) GO TO 33
        WRITE(2,280)
280     FORMAT(/,10X,'INT',5X,'PRECIP',5X,'PACUM',5X,'PERD ',5X,'PEFCT'/
     119X,'(MM)',7X,'(MM)',5X,'(MM)',7X,'(MM)'/)
 	WRITE(2,260)(I,PRE(I),PA(I),PER(I),EXE(I),I=1,NTT)
260	FORMAT(10X,I3,F11.2,F10.2,F9.2,F10.2)
33	WRITE(2,110) TOTL,TOTP,TOTE
110	FORMAT(2(/),10X,'TOTAL PRECIPITADO',F10.2,' MM',/,10X,'TOTAL',
     1' DE PERDAS',F12.2,' MM'/,10X,'TOTAL DE EXCESOS ',F10.2,' MM'//)
130	FORMAT(5F10.0)
	RETURN
	END
C*******************************
