 	SUBROUTINE NASH
	use var
	  
	DIMENSION CFS(101)

      MM=0
	WRITE(2,3003)
	READ(1,'(10F10.0)') AREA,XK,TP
	IF(XK.NE.0.) GO TO 2
      MM=1
	READ(1,'(10F10.0)') HT,XL
 	SLOPE=HT/XL
 	XLDW=(XL**2.)/AREA
 	XK=5.9485119*(AREA**.231)*(SLOPE**(-.777))*(XLDW**.124)
 	TP=1.4413144*(AREA**.422)*(SLOPE**(-.46))*(XLDW**.133)
2	PEAK=1.

 	DO 45 I=1,50
 45	Q(I,IS)=0.

C	CALCULA N POR ITERACAO
 103	XN=5.0
 	XKTP=XK/TP

 	DO 20 I=1,50
 	TINF=1.+SQRT(1./(XN-1.))
 	XN1=.05/(XKTP*(ALOG(TINF/(TINF+.05))+.05))+1
 	DIFF=ABS(XN1-XN)
 	IF(DIFF-.001)21,21,22
 22	XN=XN1
 20	CONTINUE

 	WRITE(*,23)
 	GO TO 16
C	DETERMINA C1.
 21	DELT=TINF/100.
 	TC1=0.
 	XN1P=XN-1.
 	XN1M=1.-XN

 	DO 24 I=2,101
 	TC1=TC1+DELT
   	CFS(I)=(TC1**XN1P)*EXP(XN1M*(TC1-1.))
24	CONTINUE

 	SUM=CFS(101)/2.

 	DO 25 I=2,100
 25	SUM=SUM+CFS(I)

 	C1=SUM*DELT
 	CFSII=CFS(101)
 	TTINF=TINF*TP
 	TREC1=TTINF+2.*XK
 	EEE=EXP((TTINF-TREC1)/XK)
 	XK1=3.*XK
 	B=7.056  /(C1+CFSII*(XKTP*(1.-EEE)+EEE*(XK1/TP)))
C	CALCULA B, QP E CFSI.
 	QP=(B*AREA)/TP/25.4
 	CFSI=QP*CFS(101)
 	CFSR1=CFSI*EEE
	IF(MM.EQ.1) WRITE(2,3008) HT,XL
 	WRITE(2,3007) XN,XK,QP,TP
C	CALCULO DEL HIDROGRAMA UNITARIO
 	T2=0
 	CFS(1)=0.

 	DO 11 I=2,100
 	T2=T2+AT/3600.
 	IF(T2-TTINF)9,9,10
9	CFS(I)=QP*((T2/TP)**XN1P)*EXP(XN1M*(T2/TP-1.))
 	GO TO 11
10	IF(T2-TREC1) 41,41,42
41	CFS(I)=CFSI*EXP((TTINF-T2)/XK)
 	GO TO 11
42	IF(CFSR1*EXP((TREC1-T2)/XK1).GT.0.001) GO TO 771
	CFS(I)=0.
	GO TO 12
771	CFS(I)=CFSR1*EXP((TREC1-T2)/XK1)
 	IF(CFS(I)-0.1)12,12,11
 11	CONTINUE

 	I=100
 12	ICND=I
C	CALCULO DEL HIDROGRAMA DE LA TORMENTA
 	DO 43 J=2,NTT+1
 	N=J+ICND-2
 	IF(N - 100) 46,46,47
 47	N=100
 46	KK=J
 	I=2
 	DO 43 K=KK,N
 	Q(K,IS)=Q(K,IS)+PEF(J-1)*CFS(I)
 43	I=I+1
 	M=K-1
 	RO=0.

 	DO 44 I=2,M
C	CALCULO DO VOLUME ESCOADO
 	RO=RO+Q(I,IS)
C	DETERMINACAO DO PICO
 	IF(Q(I,IS)-PEAK) 44,44,112
 112	PEAK=Q(I,IS)
 44	CONTINUE

 	ROIN=(RO*AT)/(AREA*0.1E+04)
	WRITE(2,3005) ROIN,PEAK,AREA
!________________________________________________________________________________
3005	FORMAT(//,10X,'LAMINA(MM)=',F8.1,3X,'QP(M3/S)=',F8.2,3X,
     1'AREA(KM2)=',F8.2)
3003	FORMAT(5(/),10X,'METODO DE NASH MODIFICADO',///)
 23	FORMAT('N NO CONVERGE LUEGO DE 50 ITERACIONES')
3007	FORMAT(10X,'NRO RESER=',F13.1,5X,'CTE RESER =',F10.1,' HS',/
     110X,'PICO UNIT(M3/S)=',F7.1,5X,'TP UNIT =',F10.1,' HS')
3008	FORMAT(10X,'MAX DESNIVEL =',F10.1,' M',3X,'COMP CANAL PRIN =',
     1	F10.1,' KM',/)

16	RETURN
	END
